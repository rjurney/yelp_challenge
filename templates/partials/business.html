<!-- Extend our site layout -->
{% extends "layout.html" %}

<!-- Include our common macro set -->
{% import "macros.jnj" as common %}

<!-- Parse a pig tuple being passed through in string format -->

{% block content -%}
  <div class="row">
    <div class="col-md-12">
      <p class="lead">{{ business['name'] }}</p>
      <table class="table table-striped table-condensed">
        <thead>
          <th>Business ID</th>
          <th>Full Address</th>
          <th>Open Status</th>
          <th>Categories</th>
          <th>Stars</th>
        </thead>
        <tbody>
            <td>{{ business['business_id'] }}</td>
            <td>{{ business['full_address'] }}</td>
            <td>{{ business['open'] }}</td>
            <td>{% for category in business['categories'] -%}<div>{{ category }}</div>{% endfor -%}</td>
            <td>{{ business['stars'] }}</td>
        </tbody>
      </table>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
    <p class="lead">Map</p>
    <div id="map"></div>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.1/leaflet.js"></script>
    <style>
      #map { height: 280px; }
    </style>
    <script>var map = L.map('map').setView([{{ business['latitude'] }}, {{ business['longitude'] }}], 14);
            L.tileLayer('http://{s}.tile.cloudmade.com/03ab408055d8425eb5161bf48fbb7435/997/256/{z}/{x}/{y}.png', {
                attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
                maxZoom: 18
            }).addTo(map);
            var marker = L.marker([{{ business['latitude'] }}, {{ business['longitude'] }}]).addTo(map);
            marker.bindPopup("{{ business['name'] }}").openPopup();
    </script>
  </div>
  <div class="row">
    <div class="col-md-6">
      <p class="lead">Checkin Hours</p>
      <div id="chart">
          <svg style='height:320px; '> </svg>
      </div>
      <script>
      nv.addGraph(function() {
        var chart = nv.models.discreteBarChart()
          .x(function(d) { return d.label })
          .y(function(d) { return d.value })
          .staggerLabels(false)
          .tooltips(false)
          .showValues(false)
        .color(function(x) {'blue'})

      d3.select('#chart svg')
        .datum({{ hours_json | safe }})
        .transition().duration(500)
        .call(chart);

      nv.utils.windowResize(chart.update);

      return chart;
});
        </script>
    </div>
  </div>
  <div class="row" style="margin-top: 20px;">
    <p class="lead">Reviews</p>
    <div class="col-md-4">
      <table class="table table-striped table-condensed" style="width: 600px;">
        <thead>
          <th>Name</th>
          <th>Stars</th>
          <th>Review</th>
        </thead>
        <tbody>
          {% for r in revs %}
          <tr style="white-space:nowrap;">
            <td>{{ r['review_id'] }}</td>
            <td>{{ r['stars'] }}</td>
            <td style="white-space:nowrap;">{{ r['text'] }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table> 
    </div>
  </div>

{% endblock -%}
